<?xml version="1.0" encoding="UTF-8"?>

<!-- This ORCHESTRA concert file defines a model system for performing batch calculations. -->

<Concert>

   <!--  First we define a single cell/node, which reads the input.dat file to see if any specific cell/node variables are defined. -->
   <!--  In this case we just use the default variables that are defined in input, output and chemistry file.  -->   
   <Nodes TypeFile="input.dat" NrNodes="2" />


   <!--  Now we define a task that reads the input.dat file and put the values given there in cell 0 -->
   <Task Name="Read node composition 1" Type="InstreamGroup">
      <File>input_pressure_volume.dat</File>
      <Nodes>(0)</Nodes>
   </Task>

   <Task Name="Read node composition 2" Type="InstreamGroup">
     <File>input_fixed_logact.dat</File>
     <Nodes>(1)</Nodes>
   </Task>

   <!--  The we define a task that equilibrates cell 0, using the chemical calculator/solver as defined in chemistry.inp -->
   <Task Name="Equilibrate node 1" Type="NodeGroup" >
     <Calculator>chemistry_pressure_volume</Calculator>
      <Nodes>(0)</Nodes>
   </Task>

   <Task Name="Equilibrate node 2" Type="NodeGroup" >
     <Calculator>chemistry_fixed_logact</Calculator>
     <Nodes>(1)</Nodes>
   </Task>

   <!--  And finally we define a task that writes the equilibrated output in cell 0 to the file output.dat -->
   <!--  Note that the actual variables that are written to this file are defined by the column headers in the first line of the file. -->
   <!--  If no column headers are present, by default all cell variables are written to the file. -->
   <Task Name="Write output 1" Type="OutstreamGroup">
      <File>output_pressure_volume.dat</File>
      <Nodes>(0)</Nodes>
   </Task>

   <Task Name="Write output 2" Type="OutstreamGroup">
     <File>output_fixed_logact.dat</File>
     <Nodes>(1)</Nodes>
   </Task>

   <!-- Now we create a loop that repeatedly performs the three tasks, and stops when all data records from the input files are read. -->
   <Task Name="loop" Type="RepeatingTaskGroup">
     <DoTask Name="Read node composition 1" />
     <DoTask Name="Equilibrate node 1" />
     <DoTask Name="Write output 1" />
     <DoTask Name="Read node composition 2" />
     <DoTask Name="Equilibrate node 2" />
     <DoTask Name="Write output 2" />

   </Task>


   <!-- The run task is the main task that is called when the run button is clicked in the GUI, so this is where the calculations start -->
   <Task Name="Run" Type="TaskGroup">
     <DoTask Name="loop" />
   </Task>

</Concert>
